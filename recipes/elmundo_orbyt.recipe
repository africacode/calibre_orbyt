import os
from calibre.web.feeds.news import BasicNewsRecipe
from datetime import datetime

class ElMundoOrbyt(BasicNewsRecipe):
    title = 'El Mundo Orbyt'
    oldest_article = 1
    max_articles_per_feed = 1

    ORBYT_USER = os.getenv('ORBYT_USER')
    ORBYT_PASS = os.getenv('ORBYT_PASS')

    def get_pdf_url(self):
        date_str = datetime.now().strftime('%d_%m_%Y')
        # URL directa de descarga PDF Orbyt (ajusta si cambia)
        return f'https://quiosco.elmundo.orbyt.es/epaper/download.aspx?publication=El%20Mundo&date={date_str}'

    def fetch(self, url):
        # Simple descarga del PDF con wget o requests
        import requests
        r = requests.get(url, auth=(self.ORBYT_USER, self.ORBYT_PASS))
        r.raise_for_status()
        return r.content

    def get_articles(self):
        pdf_url = self.get_pdf_url()
        pdf_data = self.fetch(pdf_url)
        yield ('ElMundoOrbyt.pdf', pdf_data)
